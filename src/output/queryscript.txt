username: project2
password: 1234

create tablespace project2 
datafile 'C:\oraclexe\app\oracle\oradata\XE\project2.dbf'
size 10m;

create user project2 identified by 1234 default tablespace project2;

grant connect, resource, dba to project2;


create table owner(
 owner_id number primary key
 , user_id varchar(20) not null
 , password varchar(100) not null
 , shopname varchar(30) not null
 , email_id varchar(20) not null
 , email_server varchar(20) not null
 , regdate date default sysdate
);

create  sequence seq_owner
increment by 1
start with 1;

create table customer(
 customer_id number primary key
 , owner_id number
 , customer_name varchar(20) not null
 , phone varchar(30) not null
 , point number default 0
 , regdate date default sysdate
 , constraint fk_owner_customer foreign key(owner_id) references owner(owner_id)
	on delete cascade
);

create  sequence seq_customer
increment by 1
start with 1;

create table category(
 category_id number primary key
 , owner_id number
 , category_name varchar(20) not null
 , regdate date default sysdate
 , color varchar(20) not null
 , constraint fk_owner_category foreign key(owner_id) references owner(owner_id)
	on delete cascade
);

create  sequence seq_category
increment by 1
start with 1;

create table item(
 item_id number primary key
 , owner_id number
 , category_id number
 , item_name varchar(20) not null
 , price varchar(30) not null
 , filename varchar(200) not null
 , stock number default 0
 , regdate date default sysdate
 , constraint fk_owner_item foreign key(owner_id) references owner(owner_id)
	on delete cascade
 , constraint fk_category_item foreign key(category_id) references category(category_id)
	on delete set null
);

create  sequence seq_item
increment by 1
start with 1;

create table sale(
 sale_id number primary key,
 owner_id number,
 item_id number,
 customer_id number,
 category_id number,
 regdate date default sysdate,
 price number not null,
 constraint fk_owner_sale foreign key(owner_id) references owner(owner_id)
	on delete cascade,
 constraint fk_item_sale foreign key(item_id) references item(item_id)
	on delete set null,
 constraint fk_category_sale foreign key(category_id) references category(category_id)
	on delete set null,
 constraint fk_customer_sale foreign key(customer_id) references customer(customer_id)
	on delete set null
);

create  sequence seq_sale
increment by 1
start with 1;

alter table owner
add user_name varchar(20) not null; 

----------------------------------------------------------
order db

//order 요약

create table order_summary(
 order_summary_id number primary key
 , owner_id number
 , customer_id number
 , orderdate date default sysdate
 , total_price number
 , constraint fk_owner_order_summary
   foreign key(owner_id) references owner(owner_id)
   		on delete cascade
);

//order 상세정보

create table order_detail(
 order_detail_id number primary key
 , order_summary_id number
 , item_id number
 , quantity number
 , price number
 , constraint fk_order_summary_order_detail
   foreign key(order_summary_id) references order_summary(order_summary_id)
   		on delete cascade
);

create  sequence seq_order_summary
increment by 1
start with 1;

create  sequence seq_order_detail
increment by 1
start with 1;

------------------------------------------------------------------
customer review table

create table review(
	review_id number primary key
	, owner_id number 
	, customer_id number 
	, item_id number
	, comments varchar(500)
	, regdate date default sysdate
	, constraint fk_owner_review
		foreign key(owner_id) references owner(owner_id)
		on delete cascade
	, constraint fk_customer_review
		foreign key(customer_id) references customer(customer_id)
		on delete cascade
	, constraint fk_item_review
		foreign key(item_id) references item(item_id)
		on delete cascade
);

create sequence seq_review
increment by 1
start with 1;

--------------------------------------
order_detail에 orderdate 넣기
alter table order_detail
add orderdate date default sysdate;

 alter table item
 add constraint chkStock
 check (stock >=0);










